<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>İlişki Grafiği</title>
    <style>
      /* CSS */
      svg {
        border: 1px solid #ddd;
      }
      .link {
        stroke: #999;
        stroke-opacity: 0.6;
      }
      .node {
        fill: red;
        stroke: #fff;
        stroke-width: 1.5px;
      }
    </style>
  </head>
  <body>
    <svg width="1500" height="700"></svg>
    <script src="https://d3js.org/d3.v5.js"></script>
    <script>
      d3.json("hisse_iliskileri.json").then(function (data) {
        var nodes = {};
        var links = [];

        data.hisse_iliskileri.forEach(function (d) {
          var source = d.hisse1;
          var target = d.hisse2;
          var relation = d.iliski;

          if (!nodes[source]) nodes[source] = { name: source };
          if (!nodes[target]) nodes[target] = { name: target };

          links.push({ source: source, target: target, relation: relation });
        });

        var svg = d3.select("svg"),
          width = +svg.attr("width"),
          height = +svg.attr("height");

        var simulation = d3
          .forceSimulation(Object.values(nodes))
          .force(
            "link",
            d3.forceLink(links).id(function (d) {
              return d.name;
            })
          )
          .force("charge", d3.forceManyBody())
          .force("center", d3.forceCenter(width / 2, height / 2));

        var link = svg
          .selectAll(".link")
          .data(links)
          .enter()
          .append("line")
          .attr("class", "link")
          .style("stroke", "#999")
          .style("stroke-opacity", 0.6);

        var node = svg
          .selectAll(".node")
          .data(Object.values(nodes))
          .enter()
          .append("circle")
          .attr("class", "node")
          .attr("r", 5)
          .style("fill", "red")
          .call(
            d3
              .drag()
              .on("start", dragstarted)
              .on("drag", dragged)
              .on("end", dragended)
          );

        node.append("title").text(function (d) {
          return d.name;
        });

        simulation.on("tick", ticked);

        function ticked() {
          link
            .attr("x1", function (d) {
              return d.source.x;
            })
            .attr("y1", function (d) {
              return d.source.y;
            })
            .attr("x2", function (d) {
              return d.target.x;
            })
            .attr("y2", function (d) {
              return d.target.y;
            });

          node
            .attr("cx", function (d) {
              return d.x;
            })
            .attr("cy", function (d) {
              return d.y;
            });
        }

        function dragstarted(event, d) {
          if (!event.active) simulation.alphaTarget(0.3).restart();
          d.fx = d.x;
          d.fy = d.y;
        }

        function dragged(event, d) {
          d.fx = event.x;
          d.fy = event.y;
        }

        function dragended(event, d) {
          if (!event.active) simulation.alphaTarget(0);
          d.fx = null;
          d.fy = null;
        }
      });
    </script>
  </body>
</html>
